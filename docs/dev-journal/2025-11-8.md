# 11/8 の開発記録

開発アプローチはフロントエンドファーストでいこうと思う
理由はすぐ画面が見えて進捗を実感できるから

<details>

<summary>AI 調べ</summary>

```text
アプローチ比較

1. フロントエンドファースト（UI → データ）

流れ:
1. 型定義（Menu型など）
2. モックデータ作成
3. UIコンポーネント作成（献立カード、空状態）
4. ホーム画面実装
5. 最後にデータベース接続・API実装

メリット:
- ✅ すぐに画面が見えて進捗を実感できる
- ✅ UIを触りながら「あ、ここにメモ欄も必要だな」など気づきが得られる
- ✅ デザインの問題を早期発見できる
- ✅ モチベーション維持しやすい

デメリット:
- ⚠️ 後でデータ構造を変更すると、UIも修正が必要になる可能性

---
2. データファースト（DB → UI）

流れ:
1. データベーススキーマ定義
2. マイグレーション実行
3. データアクセス層（CRUD操作）実装
4. APIエンドポイント作成
5. 最後にUIコンポーネント・画面実装

メリット:
- ✅ データ構造が最初に確定するので、後の変更が少ない
- ✅ 型安全性が最初から確保される
- ✅ バックエンドとフロントエンドの責務が明確

デメリット:
- ⚠️ 画面が見えるまで時間がかかる
- ⚠️ 実際にUIを使うまでデータ構造の問題に気づきにくい
```

</details>

型定義ファイルを作成した
AIの出したコードがいけてなかったので
定数ファイルも作成してそこから型を生成するようにリファクタリング

<details>

<summary>AI 出力コード</summary>

```ts
export type DayOfWeek = 0 | 1 | 2 | 3 | 4 | 5 | 6;
export type MealType = 'breakfast' | 'lunch' | 'dinner' | 'snack';

export interface Menu {
  id: string;
  userId: string;
  dayOfWeek: DayOfWeek;
  mealType: MealType;
  dishName: string;
  memo?: string | null;
  sortOrder: number;
  createdAt: Date;
  updatedAt: Date;
}
```

</details>

<details>

<summary>リファクタリング</summary>

型定義ファイル

```ts
// types/menu.ts
import { DAY_OF_WEEK } from '@/const/day-of-week';
import { MEAL_TYPE } from '@/const/meal-type';

export type DayOfWeekType = (typeof DAY_OF_WEEK)[keyof typeof DAY_OF_WEEK];
export type MealTypeType = (typeof MEAL_TYPE)[keyof typeof MEAL_TYPE];

export type Menu = {
  id: string;
  userId: string;
  dayOfWeek: DayOfWeekType;
  mealType: MealTypeType;
  dishName: string;
  memo?: string | null;
  sortOrder: number;
  createdAt: Date;
  updatedAt: Date;
};
```

定数ファイル

```ts
export const DAY_OF_WEEK = {
  Sunday: 0,
  Monday: 1,
  Tuesday: 2,
  Wednesday: 3,
  Thursday: 4,
  Friday: 5,
  Saturday: 6,
} as const;

export const DAY_LABELS = [
  '日曜日',
  '月曜日',
  '火曜日',
  '水曜日',
  '木曜日',
  '金曜日',
  '土曜日',
] as const;

export const DAY_SHORT_LABELS = ['日', '月', '火', '水', '木', '金', '土'] as const;
```

```ts
export const MEAL_TYPE = {
  Breakfast: 'breakfast',
  Lunch: 'lunch',
  Dinner: 'dinner',
  Snack: 'snack',
} as const;

export const MEAL_TYPE_LABELS: Record<string, string> = {
  breakfast: '朝食',
  lunch: '昼食',
  dinner: '夕食',
  snack: '間食',
} as const;
```

</details>

モックデータの作成

date-fns がなかったのでインストール

<details>

<summary>AI 出力モックデータ</summary>

```ts
import type { Menu } from '@/types/menu';
import { DAY_OF_WEEK } from '@/const/day-of-week';
import { MEAL_TYPE } from '@/const/meal-type';
import { parseISO } from 'date-fns';

/**
 * モックユーザーID
 */
const MOCK_USER_ID = 'mock-user-001';

/**
 * 週間献立モックデータ
 * 月曜〜日曜の7日分、一部の曜日は空
 */
export const MOCK_MENUS: Menu[] = [
  // 月曜日
  {
    id: 'menu-001',
    userId: MOCK_USER_ID,
    dayOfWeek: DAY_OF_WEEK.Monday,
    mealType: MEAL_TYPE.Breakfast,
    dishName: '納豆ご飯と味噌汁',
    memo: '納豆は小粒が好き',
    sortOrder: 0,
    createdAt: parseISO('2025-01-06T07:00:00'),
    updatedAt: parseISO('2025-01-06T07:00:00'),
  },
  {
    id: 'menu-002',
    userId: MOCK_USER_ID,
    dayOfWeek: DAY_OF_WEEK.Monday,
    mealType: MEAL_TYPE.Dinner,
    dishName: 'カレーライス',
    memo: 'じゃがいもと人参たっぷり',
    sortOrder: 1,
    createdAt: parseISO('2025-01-06T18:00:00'),
    updatedAt: parseISO('2025-01-06T18:00:00'),
  },

  // 火曜日
  {
    id: 'menu-003',
    userId: MOCK_USER_ID,
    dayOfWeek: DAY_OF_WEEK.Tuesday,
    mealType: MEAL_TYPE.Breakfast,
    dishName: 'トーストとコーヒー',
    memo: null,
    sortOrder: 2,
    createdAt: parseISO('2025-01-07T07:30:00'),
    updatedAt: parseISO('2025-01-07T07:30:00'),
  },
  {
    id: 'menu-004',
    userId: MOCK_USER_ID,
    dayOfWeek: DAY_OF_WEEK.Tuesday,
    mealType: MEAL_TYPE.Lunch,
    dishName: 'サラダチキン弁当',
    memo: 'コンビニで購入',
    sortOrder: 3,
    createdAt: parseISO('2025-01-07T12:00:00'),
    updatedAt: parseISO('2025-01-07T12:00:00'),
  },

  // 水曜日は空（献立なし）

  // 木曜日
  {
    id: 'menu-005',
    userId: MOCK_USER_ID,
    dayOfWeek: DAY_OF_WEEK.Thursday,
    mealType: MEAL_TYPE.Dinner,
    dishName: '鮭の塩焼き定食',
    memo: 'ほうれん草のおひたし添え',
    sortOrder: 4,
    createdAt: parseISO('2025-01-09T19:00:00'),
    updatedAt: parseISO('2025-01-09T19:00:00'),
  },

  // 金曜日
  {
    id: 'menu-006',
    userId: MOCK_USER_ID,
    dayOfWeek: DAY_OF_WEEK.Friday,
    mealType: MEAL_TYPE.Breakfast,
    dishName: 'グラノーラとヨーグルト',
    memo: 'バナナトッピング',
    sortOrder: 5,
    createdAt: parseISO('2025-01-10T07:00:00'),
    updatedAt: parseISO('2025-01-10T07:00:00'),
  },
  {
    id: 'menu-007',
    userId: MOCK_USER_ID,
    dayOfWeek: DAY_OF_WEEK.Friday,
    mealType: MEAL_TYPE.Dinner,
    dishName: 'ピザとサラダ',
    memo: '金曜日は外食！',
    sortOrder: 6,
    createdAt: parseISO('2025-01-10T20:00:00'),
    updatedAt: parseISO('2025-01-10T20:00:00'),
  },

  // 土曜日
  {
    id: 'menu-008',
    userId: MOCK_USER_ID,
    dayOfWeek: DAY_OF_WEEK.Saturday,
    mealType: MEAL_TYPE.Lunch,
    dishName: 'パスタカルボナーラ',
    memo: null,
    sortOrder: 7,
    createdAt: parseISO('2025-01-11T13:00:00'),
    updatedAt: parseISO('2025-01-11T13:00:00'),
  },
  {
    id: 'menu-009',
    userId: MOCK_USER_ID,
    dayOfWeek: DAY_OF_WEEK.Saturday,
    mealType: MEAL_TYPE.Snack,
    dishName: 'ケーキとコーヒー',
    memo: 'カフェで休憩',
    sortOrder: 8,
    createdAt: parseISO('2025-01-11T15:00:00'),
    updatedAt: parseISO('2025-01-11T15:00:00'),
  },

  // 日曜日は空（献立なし）
];

/**
 * 特定の曜日の献立を取得
 */
export const getMenusByDay = (dayOfWeek: number): Menu[] => {
  return MOCK_MENUS.filter((menu) => menu.dayOfWeek === dayOfWeek);
};

/**
 * すべての献立を曜日ごとにグループ化
 */
export const getMenusGroupedByDay = (): Record<number, Menu[]> => {
  return MOCK_MENUS.reduce(
    (acc, menu) => {
      if (!acc[menu.dayOfWeek]) {
        acc[menu.dayOfWeek] = [];
      }
      acc[menu.dayOfWeek].push(menu);
      return acc;
    },
    {} as Record<number, Menu[]>
  );
};
```

</details>

献立カードコンポーネントの作成
特に捻りもなく `React Native Reusables` の `Card` コンポーネントで実装

<details>

<summary>AI 出力: 献立カードコンポーネント</summary>

```tsx
import { MEAL_TYPE_LABELS } from '@/const/meal-type';
import type { Menu } from '@/types/menu';
import { Card, CardContent, CardHeader, CardTitle } from './ui/card';
import { Badge } from '@/components/ui/badge';
import { Text } from '@/components/ui/text';

type MenuCardProps = {
  menu: Menu;
};

export function MenuCard({ menu }: MenuCardProps) {
  const mealTypeLabel = MEAL_TYPE_LABELS[menu.mealType] || '不明';

  return (
    <Card className="mb-3">
      <CardHeader className="flex-row items-center justify-between">
        <CardTitle className="text-base">{menu.dishName}</CardTitle>
        <Badge variant="secondary" className="ml-2">
          <Text className="text-xs">{mealTypeLabel}</Text>
        </Badge>
      </CardHeader>
      {menu.memo && (
        <CardContent>
          <Text className="text-sm text-muted-foreground">{menu.memo}</Text>
        </CardContent>
      )}
    </Card>
  );
}
```

</details>

空の状態のコンポーネントを作成

<details>

<summary>AI 出力: 空状態コンポーネント</summary>

```tsx
import { Button } from '@/components/ui/button';
import { Icon } from '@/components/ui/icon';
import { Text } from '@/components/ui/text';
import { PlusCircle } from 'lucide-react-native';
import { View } from 'react-native';

interface EmptyMenuProps {
  dayLabel: string;
  onAddPress?: () => void;
}

export function EmptyMenu({ dayLabel, onAddPress }: EmptyMenuProps) {
  return (
    <View className="items-center justify-center rounded-lg border-2 border-dashed border-border bg-muted/20 px-4 py-8">
      <Text className="mb-4 text-center text-muted-foreground">{dayLabel}の献立がありません</Text>
      {onAddPress && (
        <Button variant="outline" size="sm" onPress={onAddPress}>
          <Icon as={PlusCircle} size={16} className="mr-2" />
          <Text>献立を追加</Text>
        </Button>
      )}
    </View>
  );
}
```

</details>

作成したコンポーネントをページに実装

<details>

<summary>AI出力: メインページ</summary>

```tsx
import { EmptyMenu } from '@/components/empty-menu';
import { MenuCard } from '@/components/menu-card';
import { Text } from '@/components/ui/text';
import { DAY_LABELS } from '@/const/day-of-week';
import { MOCK_MENUS } from '@/lib/mock-data';
import type { Menu } from '@/types/menu';
import { Stack } from 'expo-router';
import { useEffect, useState } from 'react';
import { ScrollView, View } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';

export default function HomeScreen() {
  const [menus, setMenus] = useState<Menu[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  // モックデータを読み込む（後でAPI呼び出しに置き換え）
  useEffect(() => {
    // ローディングシミュレーション
    setTimeout(() => {
      setMenus(MOCK_MENUS);
      setIsLoading(false);
    }, 500);
  }, []);

  // 曜日ごとにグループ化（月曜=0, 日曜=6）
  const menusByDay = DAY_LABELS.map((label, index) => ({
    label,
    dayOfWeek: index,
    menus: menus.filter((menu) => menu.dayOfWeek === index),
  }));

  return (
    <SafeAreaView className="flex-1 bg-background" edges={['bottom']}>
      <Stack.Screen
        options={{
          title: 'ういごはん',
        }}
      />

      <ScrollView className="flex-1 bg-background">
        {/* ユーザー情報ヘッダー（将来実装） */}
        <View className="border-b border-border bg-card p-4">
          <Text className="text-lg font-semibold">今週の献立</Text>
          <Text className="text-sm text-muted-foreground">月曜日から日曜日までの7日分</Text>
        </View>

        {/* 献立リスト */}
        <View className="p-4">
          {isLoading ? (
            <View className="items-center justify-center py-8">
              <Text className="text-muted-foreground">献立を読み込んでいます...</Text>
            </View>
          ) : (
            menusByDay.map(({ label, dayOfWeek, menus: dayMenus }) => (
              <View key={dayOfWeek} className="mb-6">
                <Text className="mb-3 text-xl font-bold">{label}</Text>

                {dayMenus.length > 0 ? (
                  dayMenus.map((menu) => <MenuCard key={menu.id} menu={menu} />)
                ) : (
                  <EmptyMenu
                    dayLabel={label}
                    onAddPress={() => {
                      // 献立追加画面への遷移（将来実装）
                      console.log('Add menu for:', dayOfWeek);
                    }}
                  />
                )}
              </View>
            ))
          )}
        </View>
      </ScrollView>
    </SafeAreaView>
  );
}
```

</details>

<details>

<summary>完成画面</summary>

[![Image from Gyazo](https://i.gyazo.com/39442812af83b5c6cf3d3005d5950e44.gif)](https://gyazo.com/39442812af83b5c6cf3d3005d5950e44)

</details>

さらに曜日部分もカード化してコンポーネントに切り出し
追加ボタンをヘッダーに追加してみたり

<details>

<summary>曜日カードコンポーネント</summary>

```tsx
import { EmptyMenu } from '@/components/empty-menu';
import { MenuCard } from '@/components/menu-card';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Text } from '@/components/ui/text';
import type { Menu } from '@/types/menu';
import { View } from 'react-native';

type DaySectionProps = {
  dayLabel: string;
  dayOfWeek: number;
  menus: Menu[];
  onAddPress?: () => void;
};

export function DaySection({ dayLabel, dayOfWeek, menus, onAddPress }: DaySectionProps) {
  return (
    <Card>
      <CardHeader className="border-b border-border">
        <View className="mb-6 flex-row items-center justify-between">
          <CardTitle className="text-lg">{dayLabel}</CardTitle>
          {menus.length > 0 && (
            <Button onPress={onAddPress}>
              <Text>献立を追加</Text>
            </Button>
          )}
        </View>
      </CardHeader>

      <CardContent className="pt-4">
        {menus.length > 0 ? (
          <View className="gap-3">
            {menus.map((menu) => (
              <MenuCard key={menu.id} menu={menu} />
            ))}
          </View>
        ) : (
          <EmptyMenu dayLabel={dayLabel} onAddPress={onAddPress} />
        )}
      </CardContent>
    </Card>
  );
}
```

</details>

<details>

<summary>完成画面<summary>

[![Image from Gyazo](https://i.gyazo.com/6a1e945aa9ac97d99e9d1ea63251aeb4.gif)](https://gyazo.com/6a1e945aa9ac97d99e9d1ea63251aeb4)

</details>
